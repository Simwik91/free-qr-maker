<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Advanced QR code generator with custom colors, logo embedding, size control, and bulk processing">
  <meta name="keywords" content="qr code generator, custom qr code, qr with logo, bulk qr codes, qr scanner">
  <title>Advanced QR Code Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LR5XP1GJFC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LR5XP1GJFC');
  </script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
  <style>
    :root {
      --primary: #007acc;
      --primary-dark: #005fa3;
      --secondary: #ff6600;
      --secondary-dark: #cc5200;
      --light-bg: #f4f4f4;
      --card-bg: #ffffff;
      --text: #333;
      --text-light: #666;
      --border: #ddd;
      --error: #d9534f;
      --success: #5cb85c;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light-bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    
    header {
      text-align: center;
      padding: 20px 0;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: var(--primary);
    }
    
    .subtitle {
      font-size: 1.2rem;
      color: var(--text-light);
      max-width: 700px;
      margin: 0 auto 20px;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      padding: 25px;
      transition: transform 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card-title i {
      font-size: 1.3rem;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
    }
    
    input[type="text"], 
    input[type="color"],
    input[type="range"],
    input[type="file"],
    select,
    textarea {
      width: 100%;
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      background: #fafafa;
      transition: all 0.3s;
    }
    
    input[type="text"]:focus, 
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.2);
    }
    
    .color-group {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .color-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .color-input input[type="color"] {
      width: 40px;
      height: 40px;
      padding: 2px;
      cursor: pointer;
    }
    
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    button.secondary {
      background: var(--secondary);
    }
    
    button.secondary:hover {
      background: var(--secondary-dark);
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .flex-container {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    
    .flex-container > * {
      flex: 1;
      min-width: 300px;
    }
    
    .qr-result {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    #qr-canvas {
      max-width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      background: white;
    }
    
    .history-item {
      padding: 15px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .history-item:hover {
      border-color: var(--primary);
      background: rgba(0, 122, 204, 0.05);
    }
    
    .history-content {
      max-width: 80%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .history-date {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    
    .scanner-container {
      position: relative;
      width: 100%;
      height: 300px;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      margin-top: 20px;
    }
    
    #scanner-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .scanner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.5);
    }
    
    .scanner-box {
      width: 250px;
      height: 250px;
      border: 3px solid white;
      box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
    }
    
    .scan-result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #f8f9fa;
      border: 1px solid var(--border);
    }
    
    .sister-tools {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .sister-tool {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s;
      border: 1px solid var(--border);
    }
    
    .sister-tool:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .sister-tool h3 {
      color: var(--primary);
      margin: 15px 0 10px;
    }
    
    .sister-tool p {
      color: var(--text-light);
      margin-bottom: 20px;
    }
    
    footer {
      text-align: center;
      padding: 30px 0;
      color: var(--text-light);
      margin-top: 30px;
      border-top: 1px solid var(--border);
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .tab {
      padding: 12px 25px;
      cursor: pointer;
      background: #f1f1f1;
      border-radius: 8px 8px 0 0;
      margin-right: 5px;
      font-weight: 500;
    }
    
    .tab.active {
      background: var(--primary);
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .error {
      color: var(--error);
      padding: 10px;
      background: rgba(217, 83, 79, 0.1);
      border-radius: 8px;
      margin: 10px 0;
      display: none;
    }
    
    .success {
      color: var(--success);
      padding: 10px;
      background: rgba(92, 184, 92, 0.1);
      border-radius: 8px;
      margin: 10px 0;
      display: none;
    }
    
    .logo-preview {
      width: 60px;
      height: 60px;
      border: 1px dashed var(--border);
      border-radius: 8px;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .logo-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .size-value {
      text-align: center;
      font-weight: bold;
      margin-top: 5px;
    }
    
    .history-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .flex-container {
        flex-direction: column;
      }
      
      .color-group {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-qrcode"></i> Advanced QR Code Generator</h1>
      <p class="subtitle">Create custom QR codes with logos, custom colors, and bulk processing. All processing happens in your browser - your data never leaves your device.</p>
    </header>
    
    <div class="tabs">
      <div class="tab active" data-tab="single">Single QR Code</div>
      <div class="tab" data-tab="bulk">Bulk QR Codes</div>
      <div class="tab" data-tab="scan">Scan QR Code</div>
    </div>
    
    <!-- Single QR Code Tab -->
    <div class="tab-content active" id="single-tab">
      <div class="flex-container">
        <div class="card">
          <h2 class="card-title"><i class="fas fa-cog"></i> Settings</h2>
          
          <div class="input-group">
            <label for="qr-input">Content (URL, text, etc.)</label>
            <input type="text" id="qr-input" placeholder="https://example.com or any text" autofocus>
            <div class="error" id="input-error">Please enter some content for the QR code</div>
          </div>
          
          <div class="input-group">
            <label>Colors</label>
            <div class="color-group">
              <div class="color-input">
                <label for="fg-color">Foreground:</label>
                <input type="color" id="fg-color" value="#000000">
              </div>
              <div class="color-input">
                <label for="bg-color">Background:</label>
                <input type="color" id="bg-color" value="#FFFFFF">
              </div>
            </div>
          </div>
          
          <div class="input-group">
            <label for="size-slider">QR Code Size: <span id="size-value">256px</span></label>
            <input type="range" id="size-slider" min="128" max="1024" value="256" step="32">
          </div>
          
          <div class="input-group">
            <label for="logo-upload">Add Logo (optional)</label>
            <input type="file" id="logo-upload" accept="image/*">
            <div class="logo-preview" id="logo-preview">
              <i class="fas fa-image" style="color: #ccc; font-size: 24px;"></i>
            </div>
          </div>
          
          <div class="btn-group">
            <button onclick="generateQR()"><i class="fas fa-bolt"></i> Generate QR</button>
            <button onclick="downloadQR()"><i class="fas fa-download"></i> Download</button>
            <button class="secondary" onclick="clearForm()"><i class="fas fa-trash"></i> Clear</button>
          </div>
        </div>
        
        <div class="card">
          <h2 class="card-title"><i class="fas fa-qrcode"></i> QR Code Result</h2>
          <div class="loading" id="qr-loading">
            <div class="spinner"></div>
            Generating QR Code...
          </div>
          <div class="error" id="qr-error"></div>
          <div class="qr-result" id="qr-result">
            <canvas id="qr-canvas" width="256" height="256"></canvas>
            <div class="success" id="qr-success">QR Code generated successfully!</div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2 class="card-title"><i class="fas fa-history"></i> Generation History</h2>
        <div class="error" id="history-error">No QR codes generated yet</div>
        <div id="history-list"></div>
        <div class="history-actions">
          <button onclick="clearHistory()"><i class="fas fa-trash"></i> Clear History</button>
        </div>
      </div>
    </div>
    
    <!-- Bulk QR Codes Tab -->
    <div class="tab-content" id="bulk-tab">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-barcode"></i> Bulk QR Code Generator</h2>
        
        <div class="input-group">
          <label for="bulk-input">Enter URLs or text (one per line):</label>
          <textarea id="bulk-input" rows="8" placeholder="https://example.com/page1
https://example.com/page2
Any text or data"></textarea>
        </div>
        
        <div class="input-group">
          <label for="bulk-filename">File Name Prefix:</label>
          <input type="text" id="bulk-filename" value="qr-codes">
        </div>
        
        <div class="btn-group">
          <button onclick="generateBulkQR()"><i class="fas fa-cogs"></i> Generate Bulk QR Codes</button>
          <button id="download-bulk" disabled><i class="fas fa-file-archive"></i> Download as ZIP</button>
        </div>
        
        <div class="loading" id="bulk-loading">
          <div class="spinner"></div>
          <div id="bulk-progress">Generating QR codes: 0/0</div>
        </div>
        
        <div class="success" id="bulk-success"></div>
        <div class="error" id="bulk-error"></div>
      </div>
    </div>
    
    <!-- Scan QR Code Tab -->
    <div class="tab-content" id="scan-tab">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-camera"></i> QR Code Scanner</h2>
        
        <div class="scanner-container">
          <video id="scanner-video"></video>
          <div class="scanner-overlay" id="scanner-overlay">
            <div class="scanner-box"></div>
          </div>
        </div>
        
        <div class="btn-group">
          <button id="start-scan"><i class="fas fa-play"></i> Start Scanner</button>
          <button id="stop-scan" class="secondary"><i class="fas fa-stop"></i> Stop Scanner</button>
        </div>
        
        <div class="scan-result" id="scan-result">
          <p>Scan results will appear here</p>
        </div>
      </div>
    </div>
    
    <!-- Sister Sites Section -->
    <div class="sister-tools">
      <div class="sister-tool">
        <i class="fas fa-image fa-3x" style="color: #ff6600;"></i>
        <h3>Free Image Toolkit</h3>
        <p>Resize, compress, and convert images without uploading to any server.</p>
        <a href="https://www.free-image-toolkit.com" target="_blank" class="btn secondary">Visit Tool</a>
      </div>
      
      <div class="sister-tool">
        <i class="fas fa-video fa-3x" style="color: #007acc;"></i>
        <h3>Free Video Toolkit</h3>
        <p>Convert, trim, and compress videos directly in your browser.</p>
        <a href="https://www.free-video-toolkit.com" target="_blank" class="btn secondary">Visit Tool</a>
      </div>
      
      <div class="sister-tool">
        <i class="fas fa-barcode fa-3x" style="color: #5cb85c;"></i>
        <h3>Free Barcode Generator</h3>
        <p>Create custom barcodes in various formats for your business needs.</p>
        <a href="https://www.free-ean-maker.com" target="_blank" class="btn secondary">Visit Tool</a>
      </div>
    </div>
    
    <footer>
      <p>Advanced QR Code Generator &copy; 2023 | Made with ❤️ | All processing happens in your browser - your data never leaves your device</p>
    </footer>
  </div>

  <script>
    // DOM Elements
    const qrInput = document.getElementById('qr-input');
    const qrCanvas = document.getElementById('qr-canvas');
    const fgColor = document.getElementById('fg-color');
    const bgColor = document.getElementById('bg-color');
    const sizeSlider = document.getElementById('size-slider');
    const sizeValue = document.getElementById('size-value');
    const logoUpload = document.getElementById('logo-upload');
    const logoPreview = document.getElementById('logo-preview');
    const qrResult = document.getElementById('qr-result');
    const qrLoading = document.getElementById('qr-loading');
    const qrError = document.getElementById('qr-error');
    const qrSuccess = document.getElementById('qr-success');
    const historyList = document.getElementById('history-list');
    const historyError = document.getElementById('history-error');
    const video = document.getElementById('scanner-video');
    const scanResult = document.getElementById('scan-result');
    const startScanBtn = document.getElementById('start-scan');
    const stopScanBtn = document.getElementById('stop-scan');
    const scannerOverlay = document.getElementById('scanner-overlay');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const bulkInput = document.getElementById('bulk-input');
    const bulkFilename = document.getElementById('bulk-filename');
    const downloadBulkBtn = document.getElementById('download-bulk');
    const bulkLoading = document.getElementById('bulk-loading');
    const bulkProgress = document.getElementById('bulk-progress');
    const bulkSuccess = document.getElementById('bulk-success');
    const bulkError = document.getElementById('bulk-error');
    
    // State variables
    let currentStream = null;
    let logoImage = null;
    let generatedQR = null;
    let history = JSON.parse(localStorage.getItem('qrHistory')) || [];
    let bulkQRs = [];
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      updateSizeValue();
      loadHistory();
      
      // Tab switching
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        });
      });
      
      // Size slider
      sizeSlider.addEventListener('input', updateSizeValue);
      
      // Logo upload
      logoUpload.addEventListener('change', handleLogoUpload);
      
      // Auto-detect URL
      qrInput.addEventListener('blur', autoFormatURL);
      
      // Scanner controls
      startScanBtn.addEventListener('click', startScanner);
      stopScanBtn.addEventListener('click', stopScanner);
    });
    
    // Update size value display
    function updateSizeValue() {
      sizeValue.textContent = `${sizeSlider.value}px`;
    }
    
    // Handle logo upload
    function handleLogoUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        logoImage = new Image();
        logoImage.onload = function() {
          logoPreview.innerHTML = '';
          const img = document.createElement('img');
          img.src = event.target.result;
          logoPreview.appendChild(img);
        };
        logoImage.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    // Auto-format URL
    function autoFormatURL() {
      const input = qrInput.value.trim();
      if (!input) return;
      
      // Check if it looks like a URL but missing protocol
      if (input.includes('.') && !input.startsWith('http://') && !input.startsWith('https://')) {
        qrInput.value = `https://${input}`;
      }
    }
    
    // Generate QR Code
    function generateQR() {
      const input = qrInput.value.trim();
      if (!input) {
        showError(qrError, 'Please enter some content for the QR code');
        return;
      }
      
      // Show loading
      qrLoading.style.display = 'block';
      qrError.style.display = 'none';
      qrSuccess.style.display = 'none';
      
      setTimeout(() => {
        try {
          const size = parseInt(sizeSlider.value);
          qrCanvas.width = size;
          qrCanvas.height = size;
          
          const ctx = qrCanvas.getContext('2d');
          ctx.clearRect(0, 0, size, size);
          
          // Generate QR code
          QRCode.toCanvas(qrCanvas, input, {
            width: size,
            margin: 1,
            color: {
              dark: fgColor.value,
              light: bgColor.value
            }
          }, function(error) {
            if (error) {
              showError(qrError, 'Error generating QR code: ' + error.message);
              qrLoading.style.display = 'none';
              return;
            }
            
            // Add logo if exists
            if (logoImage) {
              const logoSize = size / 4;
              const logoX = (size - logoSize) / 2;
              const logoY = (size - logoSize) / 2;
              
              // Draw white background for logo
              ctx.fillStyle = bgColor.value;
              ctx.fillRect(logoX - 2, logoY - 2, logoSize + 4, logoSize + 4);
              
              // Draw logo
              ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
            }
            
            // Store generated QR data URL
            generatedQR = qrCanvas.toDataURL('image/png');
            
            // Add to history
            addToHistory(input);
            
            // Show success
            qrLoading.style.display = 'none';
            qrSuccess.style.display = 'block';
            qrSuccess.textContent = 'QR Code generated successfully!';
          });
        } catch (error) {
          showError(qrError, 'Error: ' + error.message);
          qrLoading.style.display = 'none';
        }
      }, 300);
    }
    
    // Download QR Code
    function downloadQR() {
      if (!generatedQR) {
        showError(qrError, 'Please generate a QR code first');
        return;
      }
      
      const a = document.createElement('a');
      a.href = generatedQR;
      a.download = 'qr-code.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    // Add to history
    function addToHistory(content) {
      const historyItem = {
        content: content,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleString()
      };
      
      // Add to beginning of history
      history.unshift(historyItem);
      
      // Limit to 10 items
      if (history.length > 10) {
        history.pop();
      }
      
      // Save to localStorage
      localStorage.setItem('qrHistory', JSON.stringify(history));
      
      // Update UI
      loadHistory();
    }
    
    // Load history
    function loadHistory() {
      historyList.innerHTML = '';
      
      if (history.length === 0) {
        historyError.style.display = 'block';
        return;
      }
      
      historyError.style.display = 'none';
      
      history.forEach((item, index) => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="history-content" title="${item.content}">${item.content}</div>
          <div class="history-date">${item.date}</div>
        `;
        
        historyItem.addEventListener('click', () => {
          qrInput.value = item.content;
          generateQR();
        });
        
        historyList.appendChild(historyItem);
      });
    }
    
    // Clear history
    function clearHistory() {
      history = [];
      localStorage.removeItem('qrHistory');
      loadHistory();
    }
    
    // Clear form
    function clearForm() {
      qrInput.value = '';
      fgColor.value = '#000000';
      bgColor.value = '#FFFFFF';
      sizeSlider.value = '256';
      updateSizeValue();
      logoUpload.value = '';
      logoPreview.innerHTML = '<i class="fas fa-image" style="color: #ccc; font-size: 24px;"></i>';
      logoImage = null;
      generatedQR = null;
      const ctx = qrCanvas.getContext('2d');
      ctx.clearRect(0, 0, qrCanvas.width, qrCanvas.height);
      qrError.style.display = 'none';
      qrSuccess.style.display = 'none';
    }
    
    // Start scanner
    function startScanner() {
      scannerOverlay.style.display = 'flex';
      scanResult.innerHTML = '<p>Scanning... Point camera at a QR code</p>';
      
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(stream => {
          currentStream = stream;
          video.srcObject = stream;
          video.play();
          
          requestAnimationFrame(scanQR);
        })
        .catch(err => {
          console.error('Camera error: ', err);
          scanResult.innerHTML = `<p class="error">Error accessing camera: ${err.message}</p>`;
        });
    }
    
    // Stop scanner
    function stopScanner() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
        currentStream = null;
      }
      scannerOverlay.style.display = 'none';
    }
    
    // Scan QR Code
    function scanQR() {
      if (!currentStream) return;
      
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height);
        
        if (code) {
          scanResult.innerHTML = `
            <p><strong>QR Code detected!</strong></p>
            <p><strong>Content:</strong> ${code.data}</p>
            <button onclick="useScannedContent('${code.data.replace(/'/g, "\\'")}')">
              <i class="fas fa-qrcode"></i> Generate this QR
            </button>
          `;
        }
      }
      
      requestAnimationFrame(scanQR);
    }
    
    // Use scanned content
    function useScannedContent(content) {
      stopScanner();
      qrInput.value = content;
      tabs[0].click();
      generateQR();
    }
    
    // Generate bulk QR codes
    function generateBulkQR() {
      const inputs = bulkInput.value.trim().split('\n').filter(line => line.trim() !== '');
      
      if (inputs.length === 0) {
        showError(bulkError, 'Please enter at least one item');
        return;
      }
      
      if (inputs.length > 50) {
        showError(bulkError, 'For performance reasons, please limit to 50 items at once');
        return;
      }
      
      // Reset state
      bulkQRs = [];
      downloadBulkBtn.disabled = true;
      bulkSuccess.style.display = 'none';
      bulkError.style.display = 'none';
      bulkLoading.style.display = 'block';
      
      // Process in batches
      processBulkBatch(inputs, 0);
    }
    
    // Process bulk batch
    function processBulkBatch(inputs, index) {
      if (index >= inputs.length) {
        // Finished
        bulkLoading.style.display = 'none';
        bulkSuccess.style.display = 'block';
        bulkSuccess.textContent = `Successfully generated ${bulkQRs.length} QR codes!`;
        downloadBulkBtn.disabled = false;
        return;
      }
      
      // Update progress
      bulkProgress.textContent = `Generating QR codes: ${index + 1}/${inputs.length}`;
      
      const input = inputs[index];
      const canvas = document.createElement('canvas');
      canvas.width = 256;
      canvas.height = 256;
      
      try {
        QRCode.toCanvas(canvas, input, {
          width: 256,
          margin: 1,
          color: {
            dark: fgColor.value,
            light: bgColor.value
          }
        }, function(error) {
          if (error) {
            console.error('Error generating QR for: ' + input, error);
          } else {
            bulkQRs.push({
              content: input,
              dataURL: canvas.toDataURL('image/png')
            });
          }
          
          // Process next
          setTimeout(() => processBulkBatch(inputs, index + 1), 50);
        });
      } catch (error) {
        console.error('Error generating QR for: ' + input, error);
        setTimeout(() => processBulkBatch(inputs, index + 1), 50);
      }
    }
    
    // Download bulk QR codes as ZIP
    downloadBulkBtn.addEventListener('click', () => {
      if (bulkQRs.length === 0) {
        showError(bulkError, 'No QR codes to download. Please generate first.');
        return;
      }
      
      bulkLoading.style.display = 'block';
      bulkProgress.textContent = 'Creating ZIP file...';
      
      setTimeout(() => {
        try {
          const zip = new JSZip();
          const prefix = bulkFilename.value.trim() || 'qr-codes';
          
          bulkQRs.forEach((item, index) => {
            const filename = `${prefix}-${index + 1}.png`;
            // Convert data URL to blob
            const data = item.dataURL.split(',')[1];
            zip.file(filename, data, { base64: true });
          });
          
          zip.generateAsync({ type: 'blob' }).then(content => {
            saveAs(content, `${prefix}.zip`);
            bulkLoading.style.display = 'none';
          });
        } catch (error) {
          showError(bulkError, 'Error creating ZIP file: ' + error.message);
          bulkLoading.style.display = 'none';
        }
      }, 100);
    });
    
    // Helper to show error
    function showError(element, message) {
      element.textContent = message;
      element.style.display = 'block';
    }
  </script>
</body>
</html>
